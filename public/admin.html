<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>UAI Admin Dashboard</title>
</head>
<body>
  <h2>Admin Dashboard</h2>
  <div>
    <button onclick="showTab('users')">Users</button>
    <button onclick="showTab('payments')">Payments</button>
    <button onclick="showTab('withdrawals')">Withdrawals</button>
  </div>
  <div id="tab-content"></div>
  <script>
  const token = localStorage.getItem('token');
  if (!token) window.location = 'index.html';

  async function showTab(tab) {
    let url = '/api/admin/' + tab;
    const res = await fetch(url, { headers: { Authorization: 'Bearer ' + token } });
    if (!res.ok) return alert('Not authorized');
    const data = await res.json();
    const content = document.getElementById('tab-content');
    content.innerHTML = JSON.stringify(data, null, 2);
    if (tab === 'withdrawals') {
      content.innerHTML = '';
      data.forEach(w => {
        const div = document.createElement('div');
        div.textContent = `User ${w.user_id} wants to withdraw ${w.amount} KES [${w.status}]`;
        if (w.status === 'pending') {
          const approve = document.createElement('button');
          approve.textContent = 'Approve';
          approve.onclick = async () => {
            await fetch('/api/admin/approve-withdrawal', { method: 'POST', headers: { 'Content-Type': 'application/json', Authorization: 'Bearer ' + token }, body: JSON.stringify({ withdrawal_id: w.id }) });
            showTab('withdrawals');
          };
          div.appendChild(approve);
          const reject = document.createElement('button');
          reject.textContent = 'Reject';
          reject.onclick = async () => {
            await fetch('/api/admin/reject-withdrawal', { method: 'POST', headers: { 'Content-Type': 'application/json', Authorization: 'Bearer ' + token }, body: JSON.stringify({ withdrawal_id: w.id }) });
            showTab('withdrawals');
          };
          div.appendChild(reject);
        }
        content.appendChild(div);
      });
    }
  }
  showTab('users');
  </script>
</body>
</html>