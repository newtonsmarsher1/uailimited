<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Team Management</title>
  <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no">
  <style>
    body {
      background: #fffbe6;
      font-family: 'Segoe UI', Arial, sans-serif;
      margin: 0;
      color: #222;
    }
    .header {
      background: #fffbe6;
      padding: 14px 0 0 0;
      margin-bottom: -8px;
      text-align: center;
      font-weight: 700;
      font-size: 1.25em;
      color: #222;
      letter-spacing: 1px;
    }
    .team-card {
      background: #fff;
      border-radius: 18px;
      margin: 18px 8px 18px 8px;
      padding: 18px 18px 20px 18px;
      border: 1.5px solid #f4e882;
      display: flex;
      flex-direction: column;
      align-items: center;
      position: relative;
      box-shadow: 0 2px 8px #2979ff22;
    }
    .team-stat-row {
      display: flex;
      justify-content: space-between;
      width: 100%;
      font-size: 1.09em;
      margin-bottom: 16px;
      color: #555;
    }
    .team-levels-row {
      display: flex;
      gap: 12px;
      width: 100%;
      justify-content: space-between;
      margin-bottom: 10px;
    }
    .team-level-btn {
      flex: 1;
      text-align: center;
      background: #ffe600;
      border-radius: 13px;
      padding: 13px 0 10px 0;
      color: #222;
      font-weight: 700;
      font-size: 1.05em;
      border: none;
      cursor: pointer;
      box-shadow: 0 2px 8px #ffe60022;
      display: flex;
      flex-direction: column;
      align-items: center;
      text-decoration: none;
      transition: background 0.18s;
    }
    .team-level-btn.level-a { background: linear-gradient(90deg,#1175d3 70%,#fffbe6 100%); border: 2px solid #ffe600;}
    .team-level-btn.level-b { background: linear-gradient(90deg,#e2e8f0 70%,#fffbe6 100%); color: #1175d3; border: 2px solid #b8c3ce;}
    .team-level-btn.level-c { background: linear-gradient(90deg,#ffc888 70%,#fffbe6 100%); color: #d17f10; border: 2px solid #ffc888;}
    .team-level-btn svg {
      width: 30px; height: 30px; margin-bottom: 2px;
    }
    .manage-team-row {
      width: 100%;
      text-align: center;
      margin-top: 10px;
      font-size: 1.09em;
      color: #222;
      font-weight: 600;
      margin-bottom: 7px;
    }
    .manage-icons-row {
      display: flex;
      justify-content: space-between;
      gap: 15px;
      margin: 0 0 28px 0;
      width: 100%;
    }
    .manage-icon-block {
      flex: 1;
      background: #fff;
      border-radius: 12px;
      box-shadow: 0 2px 8px #ffe60022;
      padding: 13px 0 7px 0;
      text-align: center;
      color: #222;
      font-weight: 500;
      font-size: 0.97em;
      cursor: pointer;
      display: flex;
      flex-direction: column;
      align-items: center;
      border: 1px solid #ffe60044;
      transition: background 0.17s, color 0.17s;
      text-decoration: none;
    }
    .manage-icon-block.active,
    .manage-icon-block:hover {
      background: #ad7094;
      color: #1175d3;
      font-weight: 700;
      border-color: #ffe600;
    }
    .manage-icon-block svg {
      width: 28px; height: 28px; margin-bottom: 5px;
      fill:#1175d3 ;
      transition: fill 0.17s;
    }
    .manage-icon-block.active svg,
    .manage-icon-block:hover svg {
      fill: #1175d3;
    }
    .invite-banner {
      width: 100%;
      background: linear-gradient(90deg, #1175d3 80%, #ffc888 100%);
      border-radius: 15px;
      box-shadow: 0 2px 8px #ffe60044;
      margin: 0 0 22px 0;
      padding: 16px 10px;
      text-align: center;
      font-weight: 700;
      font-size: 1.08em;
      color: #d17f10;
      position: relative;
    }
    .reward-section {
      margin: 0 8px 0 8px;
    }
    .reward-title {
      font-size: 1.17em;
      font-weight: 700;
      color: #222;
      background: #fffbe6;
      padding: 18px 0 6px 0;
      text-align: center;
      letter-spacing: 0.5px;
    }
    .reward-card {
      background: #fff;
      border-radius: 14px;
      box-shadow: 0 2px 8px #ffe60022;
      padding: 11px 10px;
      margin: 13px 0 0 0;
      border: 1px solid #f4e882;
      display: flex;
      align-items: center;
      gap: 14px;
      justify-content: space-between;
    }
    .reward-img {
      width: 44px; height: 44px;
      border-radius: 50%;
      background: #1175d3;
      display: flex;
      align-items: center;
      justify-content: center;
      margin-right: 10px;
      flex-shrink: 0;
    }
    .reward-details {
      flex: 1;
      display: flex;
      flex-direction: column;
      min-width: 0;
      font-size: 0.98em;
      font-weight: 500;
      color: #222;
    }
    .reward-progress {
      width: 100%;
      height: 6px;
      background: #ffe60033;
      border-radius: 7px;
      margin: 7px 0;
      overflow: hidden;
      position: relative;
    }
    .reward-progress-bar {
      height: 100%;
      background: linear-gradient(90deg, #1175d3 85%, #ff4e50 100%);
      border-radius: 7px;
      width: 0;
      transition: width 0.6s;
    }
    .reward-status {
      background: #ccc;
      color: #fff;
      border-radius: 7px;
      padding: 6px 16px;
      font-size: 0.98em;
      font-weight: 700;
      margin-left: 11px;
      text-align: center;
      min-width: 85px;
      background: #e32f2f;
    }
    .reward-status.finished {
      background: #43e97b;
      color: #fff;
    }
    :root {
      --brand-yellow:#2979ff ;
      --brand-dark: #282828;
      --brand-accent: #2979ff;
      --icon-bg: #fff200;
      --icon-color: #282828;
      --menu-bg: #fff;
      --menu-icon-active: var(--brand-accent);
    }
    nav.bottom-nav {
      position: fixed;
      bottom: 0;
      left: 0;
      right: 0;
      height: 56px;
      background: #fff;
      display: flex;
      justify-content: space-around;
      align-items: center;
      border-top: 1px solid #e3f0ff;
      z-index: 1000;
    }
    nav.bottom-nav a {
      background: transparent;
      border: none;
      color: #282828;
      font-size: 0.85em;
      font-weight: 600;
      cursor: pointer;
      display: flex;
      flex-direction: column;
      align-items: center;
      user-select: none;
      transition: color 0.3s;
      padding: 2px 4px;
      flex-shrink: 0;
      text-decoration: none;
    }
    nav.bottom-nav a.active,
    nav.bottom-nav a:focus {
      color: var(--menu-icon-active);
    }
    nav.bottom-nav a svg {
      width: 22px;
      height: 22px;
      margin-bottom: 2px;
      fill: currentColor;
    }
    @media (max-width:600px) {
      .team-card,
      .reward-section,
      .modal-card { max-width: 98vw; }
      .team-levels-row { flex-direction: column; gap: 10px;}
      .manage-icons-row { flex-direction: column; gap: 10px;}
    }
  </style>
</head>
<body>
  <script src="js/language-manager.js"></script>
  <div class="header" data-translate="team-management-title">Team management</div>
  <div class="team-card">
    <div style="width:100%;text-align:center; font-weight:600; font-size:1.07em; margin-bottom:9px;">Total number of team members</div>
    <div style="width:100%; text-align:center; font-size:1.23em; font-weight:700; color:#2979ff; margin-bottom:13px;">1</div>
    <div class="team-stat-row">
      <div>Level A: 1 people</div>
      <div>Level B: 0 people</div>
      <div>Level C: 0 people</div>
    </div>
    <div class="team-levels-row">
      <a class="team-level-btn level-a" href="team-level-a.html">
        <svg viewBox="0 0 32 32"><path d="M16 2l4 8h8l-6 6 2 8-8-4-8 4 2-8-6-6h8z" fill="#1175d3" stroke="#222" stroke-width="1.5"/></svg>
        Level A
      </a>
      <a class="team-level-btn level-b" href="team-level-b.html">
        <svg viewBox="0 0 32 32"><path d="M16 2l4 8h8l-6 6 2 8-8-4-8 4 2-8-6-6h8z" fill="#b8c3ce" stroke="#1175d3" stroke-width="1.5"/></svg>
        Level B
      </a>
      <a class="team-level-btn level-c" href="team-level-c.html">
        <svg viewBox="0 0 32 32"><path d="M16 2l4 8h8l-6 6 2 8-8-4-8 4 2-8-6-6h8z" fill="#ffc888" stroke="#d17f10" stroke-width="1.5"/></svg>
        Level C
      </a>
    </div>
    <div class="manage-team-row">Manage my direct recruiting team</div>
    <div class="manage-icons-row">
      <a class="manage-icon-block active" href="regular-staff.html">
        <svg viewBox="0 0 24 24"><circle cx="12" cy="12" r="10"/><path d="M12 17c-2.67 0-8 1.34-8 4v1h16v-1c0-2.66-5.33-4-8-4z"/><circle cx="12" cy="8.5" r="4.5"/></svg>
        Regular staff
      </a>
      <a class="manage-icon-block" href="temporary-workers.html">
        <svg viewBox="0 0 24 24"><rect x="7" y="7" width="10" height="10" rx="2"/><path d="M9 9h6v6H9z"/></svg>
        Temporary Workers
      </a>
      <a class="manage-icon-block" href="recruitment.html">
        <svg viewBox="0 0 24 24"><rect x="3" y="4" width="18" height="2"/><rect x="3" y="18" width="18" height="2"/><rect x="3" y="8" width="18" height="2"/><rect x="3" y="14" width="18" height="2"/></svg>
        Recruitment
      </a>
      <a class="manage-icon-block" href="competition.html">
        <svg viewBox="0 0 24 24"><circle cx="12" cy="12" r="10"/><path d="M7 12h10M12 7v10"/></svg>
        Competition
      </a>
    </div>
  </div>

  <div class="invite-banner">
    <div>
      Invite your friends<br>
      <span style="color:#e32f2f;">receive rewards every day</span><br>
      watch videos easily<br>
      and receive rewards non-stop!
    </div>
  </div>

  <div class="reward-section">
    <div class="reward-title">Today's Recommended Rewards</div>
    <div style="background:#fff; border-radius:11px; padding:12px 8px 0 8px; margin-bottom:14px;">
      <div style="font-size:0.99em; font-weight:500; color:#222; margin-bottom:7px;">
        When your A-level subordinates become regular employees and reach the corresponding number,<br>
        you will receive rewards.
      </div>
      <div class="reward-card">
        <div class="reward-img">
          <img src="https://img.icons8.com/emoji/48/000000/money-bag-emoji.png" style="width:38px;height:38px;border-radius:50%;">
        </div>
        <div class="reward-details">
          Invite 1 regular employee on the day
          <div class="reward-progress"><div class="reward-progress-bar" style="width:0%"></div></div>
        </div>
        <span class="reward-status">Unfinished</span>
      </div>
      <div class="reward-card">
        <div class="reward-img">
          <img src="https://img.icons8.com/emoji/48/000000/money-bag-emoji.png" style="width:38px;height:38px;border-radius:50%;">
        </div>
        <div class="reward-details">
          Invite 3 regular employee on the day
          <div class="reward-progress"><div class="reward-progress-bar" style="width:0%"></div></div>
        </div>
        <span class="reward-status">Unfinished</span>
      </div>
      <div class="reward-card">
        <div class="reward-img">
          <img src="https://img.icons8.com/emoji/48/000000/money-bag-emoji.png" style="width:38px;height:38px;border-radius:50%;">
        </div>
        <div class="reward-details">
          Invite 5 regular employee on the day
          <div class="reward-progress"><div class="reward-progress-bar" style="width:0%"></div></div>
        </div>
        <span class="reward-status">Unfinished</span>
      </div>
    </div>
  </div>

  <h2>Temporary Workers You Invited</h2>
  <table id="temp-workers-table" border="1" style="width:100%;margin-bottom:30px;">
    <thead>
      <tr>
        <th>Phone Number</th>
        <th>Date Joined</th>
        <th>Duration</th>
        <th>Dismiss</th>
      </tr>
    </thead>
    <tbody id="temp-workers-body">
      <!-- Rows will be inserted here -->
    </tbody>
  </table>

  <nav class="bottom-nav" role="navigation" aria-label="Bottom Navigation">
    <a href="home.html" id="nav-home">
      <svg viewBox="0 0 24 24"><path d="M3 21v-7.5l9-6.5 9 6.5V21H3z"/></svg>
      <span id="nav-home-label" data-translate="nav-home-label">Home</span>
    </a>
    <a href="task.html" id="nav-task">
      <svg viewBox="0 0 24 24"><rect x="4" y="4" width="16" height="16" rx="2"/><path d="M8 10h8M8 14h4"/></svg>
      <span id="nav-task-label" data-translate="nav-task-label">Task</span>
    </a>
    <a href="team management.html" class="active" aria-current="page" id="nav-team">
      <svg viewBox="0 0 24 24"><circle cx="12" cy="8" r="3"/><path d="M12 15c-4 0-8 2-8 4v1h16v-1c0-2-4-4-8-4z"/></svg>
      <span id="nav-team-label" data-translate="nav-team-label">Team Management</span>
    </a>
    <a href="level.html" id="nav-level">
      <svg viewBox="0 0 24 24"><path d="M12 2L2 7l10 5 10-5-10-5z"/><path d="M2 7v10l10 5 10-5V7"/></svg>
      <span id="nav-level-label" data-translate="nav-level-label">Level</span>
    </a>
    <a href="profile.html" id="nav-profile">
      <svg viewBox="0 0 24 24"><circle cx="12" cy="8" r="4"/><path d="M2 20v-2a8 8 0 0 1 16 0v2"/></svg>
      <span id="nav-profile-label" data-translate="nav-profile-label">Profile</span>
    </a>
  </nav>
  <script>
    // Check authentication
    function checkAuth() {
      const token = localStorage.getItem('token');
      if (!token) {
        window.location.href = 'index.html';
        return false;
      }
      return true;
    }

    // Load team statistics from backend
    async function loadTeamStats() {
      const token = localStorage.getItem('token');
      if (!token) return;
      
      try {
        const res = await fetch('/api/team-stats', {
          headers: { Authorization: "Bearer " + token }
        });
        if (!res.ok) throw new Error('Failed to load team stats');
        
        const data = await res.json();
        
        // Update team member counts
        document.querySelector('.team-card div:nth-child(3)').textContent = data.totalTeamMembers || 0;
        document.querySelector('.team-stat-row div:nth-child(1)').textContent = `Level A: ${data.directReferrals || 0} people`;
        document.querySelector('.team-stat-row div:nth-child(2)').textContent = `Level B: ${data.indirectReferrals || 0} people`;
        document.querySelector('.team-stat-row div:nth-child(3)').textContent = `Level C: 0 people`;
        
        // Update team earnings
        console.log('Team earnings:', data.teamEarnings);
        
      } catch (error) {
        console.error('Error loading team stats:', error);
      }
    }

    // Initialize page
    document.addEventListener("DOMContentLoaded", function() {
      if (!checkAuth()) return;
      loadTeamStats();
    });

    async function fetchTemporaryWorkers() {
      const token = localStorage.getItem('token');
      const res = await fetch('/api/my-temporary-workers', {
        headers: { 'Authorization': 'Bearer ' + token }
      });
      if (!res.ok) return;
      const workers = await res.json();
      const tbody = document.getElementById('temp-workers-body');
      tbody.innerHTML = '';
      workers.forEach(worker => {
        const tr = document.createElement('tr');
        // Phone
        const tdPhone = document.createElement('td');
        tdPhone.textContent = worker.phone;
        tr.appendChild(tdPhone);
        // Date joined
        const tdDate = document.createElement('td');
        tdDate.textContent = worker.temp_worker_start_date ? worker.temp_worker_start_date.split('T')[0] : '';
        tr.appendChild(tdDate);
        // Duration
        const tdDuration = document.createElement('td');
        tdDuration.textContent = getDuration(worker.temp_worker_start_date);
        tr.appendChild(tdDuration);
        // Dismiss button
        const tdDismiss = document.createElement('td');
        const btn = document.createElement('button');
        btn.textContent = 'Dismiss';
        btn.onclick = async () => {
          if (!confirm('Are you sure you want to dismiss this temporary worker?')) return;
          const res2 = await fetch('/api/dismiss-temporary-worker', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json', 'Authorization': 'Bearer ' + token },
            body: JSON.stringify({ userId: worker.id })
          });
          const data = await res2.json();
          if (data.success) {
            tr.remove();
            alert('Temporary worker dismissed.');
          } else {
            alert('Failed to dismiss worker.');
          }
        };
        tdDismiss.appendChild(btn);
        tr.appendChild(tdDismiss);
        tbody.appendChild(tr);
      });
    }

    function getDuration(startDate) {
      if (!startDate) return '';
      const start = new Date(startDate);
      const now = new Date();
      const diff = Math.floor((now - start) / (1000 * 60 * 60 * 24));
      return diff === 0 ? 'Today' : (diff === 1 ? '1 day' : diff + ' days');
    }

    document.addEventListener('DOMContentLoaded', fetchTemporaryWorkers);
  </script>
</body>
</html>