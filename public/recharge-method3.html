<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Recharge Method 3 - UAI</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <style>
    body {
      font-family: 'Segoe UI', Arial, sans-serif;
      background: linear-gradient(135deg, #2979ff 0%, #ad7ce6 100%);
      margin: 0; padding: 0;
      min-height: 100vh;
      display: flex; flex-direction: column; align-items: center;
    }
    .container {
      background: rgba(255,255,255,0.96);
      margin-top: 60px;
      padding: 36px 24px 28px 24px;
      border-radius: 22px;
      max-width: 410px;
      width: 97vw;
      box-shadow: 0 2px 24px #ad7ce62a;
      text-align: center;
      position: relative;
    }
    .uai-logo {
      position: absolute;
      left: 50%; top: -38px;
      transform: translateX(-50%);
      width: 70px; height: 70px;
      border-radius: 50%;
      background: linear-gradient(135deg, #ad7ce6 0%, #2979ff 100%);
      display: flex; align-items: center; justify-content: center;
      box-shadow: 0 2px 18px #7a09c555;
      border: 4px solid #fff;
    }
    .uai-logo span {
      color: #fff;
      font-size: 2em;
      font-weight: 800;
      letter-spacing: 3px;
      text-shadow: 0 2px 8px #7a09c577, 0 0 2px #4f2b7c;
    }
    h2 { color: #2979ff; margin-bottom: 1.5em;}
    .info-block {
      margin: 1.3em 0 2em 0;
      background: #e3f0ff;
      border-radius: 12px;
      padding: 15px 13px;
      color: #2979ff;
      font-weight: 700;
      font-size: 1.12em;
      letter-spacing: 0.4px;
      word-break: break-all;
      box-shadow: 0 1px 8px #ad7ce632;
    }
    .copy-btn {
      background: #ad7ce6;
      color: #fff;
      border: none;
      border-radius: 8px;
      padding: 7px 18px;
      font-size: 0.95em;
      font-weight: 600;
      margin-left: 10px;
      cursor: pointer;
      margin-bottom: 1em;
      transition: background .15s;
    }
    .copy-btn:active { background: #2979ff; }
    .label {
      color: #ad7ce6;
      font-size: 0.98em;
      font-weight: 600;
      margin-bottom: 6px;
      display: block;
    }
    textarea {
      width: 100%; min-height: 62px; border-radius: 7px; border: 1px solid #ad7ce6;
      padding: 9px; font-size: 1em; margin-bottom: 1em; box-sizing: border-box;
      resize: none;
    }
    .pay-btn {
      background: linear-gradient(135deg, #ff6b35 0%, #f7931e 100%);
      color: #fff;
      border: none;
      border-radius: 12px;
      padding: 15px 30px;
      font-size: 1.1em;
      font-weight: 700;
      cursor: pointer;
      width: 100%;
      margin-top: 10px;
      transition: all 0.3s ease;
      box-shadow: 0 4px 15px rgba(255, 107, 53, 0.4);
      text-transform: uppercase;
      letter-spacing: 1px;
    }
    .pay-btn:hover {
      background: linear-gradient(135deg, #e55a2b 0%, #e0851a 100%);
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(255, 107, 53, 0.6);
    }
    .pay-btn:active {
      transform: translateY(0);
      box-shadow: 0 2px 10px rgba(255, 107, 53, 0.4);
    }
    .pay-btn:disabled {
      background: #ccc;
      cursor: not-allowed;
      transform: none;
      box-shadow: none;
    }
    .message { margin-top: 1.2em; color: #2979ff; font-weight: 600; min-height: 24px;}
    .recharge-note {
      color: #ad7ce6;
      margin-bottom: 19px;
      font-size: 1.01em;
      font-style: italic;
      text-align: center;
    }
    @media (max-width:600px) {
      .container { padding: 18px 4vw 15px 4vw; }
      .uai-logo { width: 48px; height: 48px; top: -28px; }
      .uai-logo span { font-size: 1.15em;}
      h2 { font-size: 1.1em;}
    }
  </style>
</head>
<body>
<div class="container">
  <div class="uai-logo"><span>UAI</span></div>
  <h2>Recharge - Method 3 (Send to Paybill)</h2>
  <div class="recharge-note">
    Send your payment to the following Paybill Number, Account Number, and Account Name:<br>
    <b>Paybill Number:</b>
  </div>
  <div class="info-block" id="paybill-block">
    123456
    <button type="button" class="copy-btn" onclick="copyText('123456')">Copy</button>
  </div>
  <div class="label">Account Number:</div>
  <div class="info-block" id="account-number-block">
    987654321
    <button type="button" class="copy-btn" onclick="copyText('987654321')">Copy</button>
  </div>
  <div class="label">Account Name:</div>
  <div class="info-block" id="account-name-block">
    UAI COMPANY
  </div>
  <div class="label">Paste Mpesa Payment Message Below:</div>
  <form id="msgForm">
    <textarea id="mpesa-message" placeholder="Paste your Mpesa message here"></textarea>
    <button type="submit" class="pay-btn">
      ðŸ”¥ SUBMIT PAYMENT MESSAGE ðŸ”¥
    </button>
  </form>
  <div class="message" id="message"></div>
</div>
<script>
  function copyText(text) {
    navigator.clipboard.writeText(text);
  }
  const userToken = localStorage.getItem('token');
  document.getElementById('msgForm').onsubmit = async function(e) {
    e.preventDefault();
    const mpesa_message = document.getElementById('mpesa-message').value.trim();
    if (!mpesa_message) {
      document.getElementById('message').style.color = "#c62828";
      document.getElementById('message').textContent = "Please paste your Mpesa message.";
      return;
    }
    document.getElementById('message').style.color = "#ad7ce6";
    document.getElementById('message').textContent = "Processing...";
    try {
      const res = await fetch('/api/recharge-method3', {
        method: "POST",
        headers: {
          "Content-Type": "application/json",
          Authorization: "Bearer " + userToken
        },
        body: JSON.stringify({ mpesa_message })
      });
      const data = await res.json();
      
      if (data.message && data.message.includes('confirmed')) {
        document.getElementById('message').style.color = "#2979ff";
        document.getElementById('message').textContent = data.message;
      } else if (data.error) {
        document.getElementById('message').style.color = "#c62828";
        document.getElementById('message').textContent = data.error;
      } else if (data.message) {
        document.getElementById('message').style.color = "#2979ff";
        document.getElementById('message').textContent = data.message;
      } else {
        document.getElementById('message').style.color = "#c62828";
        document.getElementById('message').textContent = "Failed to fetch payments. Please check your message and try again.";
      }
    } catch (e) {
      document.getElementById('message').style.color = "#c62828";
      document.getElementById('message').textContent = "Failed to fetch payments. Please check your internet connection and try again.";
    }
  };
</script>
</body>
</html>