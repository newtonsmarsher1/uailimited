<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Notifications - UAI</title>
  <style>
    :root {
      --brand-yellow: #2979ff;
      --brand-dark: #282828;
      --brand-accent: #2979ff;
      --icon-bg: #fff200;
      --icon-color: #282828;
      --menu-bg: #fff;
      --menu-icon-active: var(--brand-accent);
    }
    
    * { box-sizing: border-box; }
    
    body {
      margin: 0;
      padding: 0;
      font-family: 'Segoe UI', Arial, sans-serif;
      background: var(--menu-bg);
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      overflow-x: hidden;
      padding-bottom: 70px;
    }
    
    .top-section {
      background: var(--brand-yellow);
      min-height: 120px;
      position: relative;
      padding: 0 0 12px 0;
      border-bottom-left-radius: 24px;
      border-bottom-right-radius: 24px;
    }
    
    .header-row {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 14px 18px 0 18px;
    }
    
    .back-btn {
      background: var(--icon-bg);
      color: var(--icon-color);
      border: none;
      border-radius: 50%;
      width: 36px; height: 36px;
      font-size: 18px;
      cursor: pointer;
      box-shadow: 0 2px 8px rgba(41,121,255,0.15);
      display: flex;
      align-items: center;
      justify-content: center;
      transition: background 0.3s;
      -webkit-user-select: none;
      user-select: none;
    }
    
    .back-btn:hover { background: #fff; }
    
    .page-title {
      font-weight: 700;
      font-size: 1.4em;
      color: #fff;
      letter-spacing: 1px;
    }
    
    .clear-all-btn {
      background: rgba(255,255,255,0.2);
      color: #fff;
      border: 1px solid rgba(255,255,255,0.3);
      border-radius: 20px;
      padding: 8px 16px;
      font-size: 0.9em;
      font-weight: 600;
      cursor: pointer;
      transition: background 0.3s;
    }
    
    .clear-all-btn:hover {
      background: rgba(255,255,255,0.3);
    }
    
    .notifications-container {
      flex: 1;
      padding: 20px 16px;
      max-width: 600px;
      margin: 0 auto;
      width: 100%;
    }
    
    .notification-card {
      background: #fff;
      border-radius: 16px;
      padding: 16px;
      margin-bottom: 12px;
      box-shadow: 0 2px 8px rgba(41,121,255,0.08);
      border: 1px solid #e3f0ff;
      position: relative;
      transition: box-shadow 0.3s;
    }
    
    .notification-card:hover {
      box-shadow: 0 4px 16px rgba(41,121,255,0.12);
    }
    
    .notification-header {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      margin-bottom: 8px;
    }
    
    .notification-icon {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 18px;
      margin-right: 12px;
      flex-shrink: 0;
    }
    
    .notification-icon.success {
      background: #e8f5e8;
      color: #2e7d32;
    }
    
    .notification-icon.info {
      background: #e3f2fd;
      color: #1976d2;
    }
    
    .notification-icon.warning {
      background: #fff3e0;
      color: #f57c00;
    }
    
    .notification-icon.error {
      background: #ffebee;
      color: #d32f2f;
    }
    
    .notification-content {
      flex: 1;
      min-width: 0;
    }
    
    .notification-message {
      font-size: 1em;
      color: #333;
      line-height: 1.4;
      margin-bottom: 8px;
      word-wrap: break-word;
    }
    
    .notification-time {
      font-size: 0.85em;
      color: #666;
      margin-bottom: 8px;
    }
    
    .notification-type {
      display: inline-block;
      padding: 4px 8px;
      border-radius: 12px;
      font-size: 0.75em;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }
    
    .notification-type.success {
      background: #e8f5e8;
      color: #2e7d32;
    }
    
    .notification-type.info {
      background: #e3f2fd;
      color: #1976d2;
    }
    
    .notification-type.warning {
      background: #fff3e0;
      color: #f57c00;
    }
    
    .notification-type.error {
      background: #ffebee;
      color: #d32f2f;
    }
    
    .delete-btn {
      background: #ffebee;
      color: #d32f2f;
      border: none;
      border-radius: 50%;
      width: 32px;
      height: 32px;
      font-size: 16px;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: background 0.3s;
      flex-shrink: 0;
      margin-left: 8px;
    }
    
    .delete-btn:hover {
      background: #ffcdd2;
    }
    
    .empty-state {
      text-align: center;
      padding: 60px 20px;
      color: #666;
    }
    
    .empty-state-icon {
      font-size: 4em;
      margin-bottom: 16px;
      opacity: 0.5;
    }
    
    .empty-state-text {
      font-size: 1.1em;
      margin-bottom: 8px;
      color: #333;
    }
    
    .empty-state-subtext {
      font-size: 0.9em;
      color: #666;
    }
    
    .loading-spinner {
      text-align: center;
      padding: 40px 20px;
    }
    
    .spinner {
      width: 40px;
      height: 40px;
      border: 4px solid #e3f0ff;
      border-top: 4px solid #2979ff;
      border-radius: 50%;
      animation: spin 1s linear infinite;
      margin: 0 auto 16px auto;
    }
    
    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
    
    /* Bottom navigation */
    nav.bottom-nav {
      position: fixed;
      bottom: 0;
      left: 0;
      right: 0;
      height: 56px;
      background: #fff;
      display: flex;
      justify-content: space-around;
      align-items: center;
      border-top: 1px solid #e3f0ff;
      z-index: 1000;
    }
    
    nav.bottom-nav a {
      background: transparent;
      border: none;
      color: #282828;
      font-size: 0.85em;
      font-weight: 600;
      cursor: pointer;
      display: flex;
      flex-direction: column;
      align-items: center;
      -webkit-user-select: none;
      user-select: none;
      transition: color 0.3s;
      padding: 2px 4px;
      flex-shrink: 0;
      text-decoration: none;
    }
    
    nav.bottom-nav a.active,
    nav.bottom-nav a:focus {
      color: var(--menu-icon-active);
    }
    
    nav.bottom-nav a svg {
      width: 22px;
      height: 22px;
      margin-bottom: 2px;
      fill: currentColor;
    }
    
    @media (max-width: 600px) {
      .notifications-container {
        padding: 16px 12px;
      }
      
      .notification-card {
        padding: 14px;
        margin-bottom: 10px;
      }
      
      .notification-message {
        font-size: 0.95em;
      }
      
      .page-title {
        font-size: 1.2em;
      }
    }
  </style>
</head>
<body>
  <div class="top-section">
    <div class="header-row">
      <button class="back-btn" onclick="window.history.back()" aria-label="Go back">
        ‚Üê
      </button>
      <div class="page-title">Notifications</div>
      <button class="clear-all-btn" onclick="clearAllNotifications()" id="clear-all-btn" style="display: none;">
        Clear All
      </button>
    </div>
  </div>
  
  <div class="notifications-container" id="notifications-container">
    <div class="loading-spinner" id="loading-spinner">
      <div class="spinner"></div>
      <div>Loading notifications...</div>
    </div>
    
    <div class="empty-state" id="empty-state" style="display: none;">
      <div class="empty-state-icon">üîî</div>
      <div class="empty-state-text">No notifications yet</div>
      <div class="empty-state-subtext">You'll see important updates here</div>
    </div>
    
    <div id="notifications-list"></div>
  </div>
  
  <nav class="bottom-nav" aria-label="Bottom Navigation">
    <a href="home.html" id="nav-home">
      <svg viewBox="0 0 24 24"><path d="M3 21v-7.5l9-6.5 9 6.5V21H3z"/></svg>
      <span id="nav-home-label">Home</span>
    </a>
    <a href="task.html" id="nav-task">
      <svg viewBox="0 0 24 24"><rect x="4" y="4" width="16" height="16" rx="2"/><path d="M8 10h8M8 14h4"/></svg>
      <span id="nav-task-label">Task</span>
    </a>
    <a href="team management.html" id="nav-team">
      <svg viewBox="0 0 24 24"><circle cx="12" cy="8" r="3"/><path d="M12 15c-4 0-8 2-8 4v1h16v-1c0-2-4-4-8-4z"/></svg>
      <span id="nav-team-label">Team Management</span>
    </a>
    <a href="level.html" id="nav-level">
      <svg viewBox="0 0 24 24"><path d="M12 2L2 7l10 5 10-5-10-5z"/><path d="M2 7v10l10 5 10-5V7"/></svg>
      <span id="nav-level-label">Level</span>
    </a>
    <a href="profile.html" id="nav-profile">
      <svg viewBox="0 0 24 24"><circle cx="12" cy="8" r="4"/><path d="M2 20v-2a8 8 0 0 1 16 0v2"/></svg>
      <span id="nav-profile-label">Profile</span>
    </a>
  </nav>
  
  <script>
    // Check authentication
    function checkAuth() {
      const token = localStorage.getItem('token');
      if (!token) {
        window.location.href = 'index.html';
        return false;
      }
      return true;
    }
    
    // Load notifications
    async function loadNotifications() {
      const token = localStorage.getItem('token');
      if (!token) return;
      
      try {
        const res = await fetch('/api/notifications', {
          headers: { Authorization: "Bearer " + token }
        });
        
        if (!res.ok) {
          throw new Error('Failed to load notifications');
        }
        
        const notifications = await res.json();
        displayNotifications(notifications);
        
      } catch (error) {
        console.error('Error loading notifications:', error);
        showEmptyState();
      }
    }
    
    // Display notifications
    function displayNotifications(notifications) {
      const container = document.getElementById('notifications-container');
      const loadingSpinner = document.getElementById('loading-spinner');
      const emptyState = document.getElementById('empty-state');
      const clearAllBtn = document.getElementById('clear-all-btn');
      const notificationsList = document.getElementById('notifications-list');
      
      // Hide loading spinner
      loadingSpinner.style.display = 'none';
      
      if (!notifications || notifications.length === 0) {
        showEmptyState();
        return;
      }
      
      // Show clear all button if there are notifications
      clearAllBtn.style.display = 'inline-block';
      
      // Clear existing notifications
      notificationsList.innerHTML = '';
      
      // Sort notifications by date (newest first)
      notifications.sort((a, b) => new Date(b.created_at) - new Date(a.created_at));
      
      // Display each notification
      notifications.forEach(notification => {
        const notificationCard = createNotificationCard(notification);
        notificationsList.appendChild(notificationCard);
      });
    }
    
    // Create notification card
    function createNotificationCard(notification) {
      const card = document.createElement('div');
      card.className = 'notification-card';
      card.dataset.notificationId = notification.id;
      
      const icon = getNotificationIcon(notification.type);
      const typeLabel = getNotificationTypeLabel(notification.type);
      const timeAgo = getTimeAgo(notification.created_at);
      
      card.innerHTML = `
        <div class="notification-header">
          <div class="notification-icon ${notification.type}">
            ${icon}
          </div>
          <div class="notification-content">
            <div class="notification-message">${notification.message}</div>
            <div class="notification-time" data-timestamp="${notification.created_at}">${timeAgo}</div>
            <span class="notification-type ${notification.type}">${typeLabel}</span>
          </div>
          <button class="delete-btn" onclick="deleteNotification(${notification.id})" aria-label="Delete notification">
            √ó
          </button>
        </div>
      `;
      
      return card;
    }
    
    // Get notification icon based on type
    function getNotificationIcon(type) {
      const icons = {
        'success': '‚úÖ',
        'info': '‚ÑπÔ∏è',
        'warning': '‚ö†Ô∏è',
        'error': '‚ùå'
      };
      return icons[type] || '‚ÑπÔ∏è';
    }
    
    // Get notification type label
    function getNotificationTypeLabel(type) {
      const labels = {
        'success': 'Success',
        'info': 'Info',
        'warning': 'Warning',
        'error': 'Error'
      };
      return labels[type] || 'Info';
    }
    
    // Get real date from timestamp with real-time updates for 2025
    function getTimeAgo(timestamp) {
      const notificationTime = new Date(timestamp);
      const now = new Date();
      
      // Check if it's today
      const isToday = notificationTime.toDateString() === now.toDateString();
      
      if (isToday) {
        // Show time for today with real-time updates
        return `Today at ${notificationTime.toLocaleTimeString('en-US', { 
          hour: '2-digit', 
          minute: '2-digit',
          hour12: true 
        })}`;
      } else if (isYesterday(notificationTime)) {
        // Show "Yesterday" for yesterday's notifications
        return `Yesterday at ${notificationTime.toLocaleTimeString('en-US', { 
          hour: '2-digit', 
          minute: '2-digit',
          hour12: true 
        })}`;
      } else {
        // Show full date for other days with 2025 formatting
        return notificationTime.toLocaleDateString('en-US', {
          weekday: 'short',
          year: 'numeric',
          month: 'short',
          day: 'numeric',
          hour: '2-digit',
          minute: '2-digit',
          hour12: true
        });
      }
    }
    
    // Helper function to check if date is yesterday
    function isYesterday(date) {
      const yesterday = new Date();
      yesterday.setDate(yesterday.getDate() - 1);
      return date.toDateString() === yesterday.toDateString();
    }
    
    // Update notification times in real-time for 2025
    function updateNotificationTimes() {
      const notificationCards = document.querySelectorAll('.notification-card');
      notificationCards.forEach(card => {
        const timeElement = card.querySelector('.notification-time');
        if (timeElement) {
          const timestamp = timeElement.dataset.timestamp;
          if (timestamp) {
            timeElement.textContent = getTimeAgo(timestamp);
          }
        }
      });
    }
    
    // Get current timezone for 2025
    function getCurrentTimezone() {
      return Intl.DateTimeFormat().resolvedOptions().timeZone;
    }
    
    // Format date with timezone awareness for 2025
    function formatDateWithTimezone(date) {
      const timezone = getCurrentTimezone();
      return date.toLocaleString('en-US', {
        timeZone: timezone,
        weekday: 'short',
        year: 'numeric',
        month: 'short',
        day: 'numeric',
        hour: '2-digit',
        minute: '2-digit',
        hour12: true
      });
    }
    
    // Show empty state
    function showEmptyState() {
      const loadingSpinner = document.getElementById('loading-spinner');
      const emptyState = document.getElementById('empty-state');
      const clearAllBtn = document.getElementById('clear-all-btn');
      
      loadingSpinner.style.display = 'none';
      emptyState.style.display = 'block';
      clearAllBtn.style.display = 'none';
    }
    
    // Delete single notification
    async function deleteNotification(notificationId) {
      const token = localStorage.getItem('token');
      if (!token) return;
      
      try {
        const res = await fetch(`/api/notifications/${notificationId}`, {
          method: 'DELETE',
          headers: { Authorization: "Bearer " + token }
        });
        
        if (res.ok) {
          // Remove the notification card from DOM
          const notificationCard = document.querySelector(`[data-notification-id="${notificationId}"]`);
          if (notificationCard) {
            notificationCard.remove();
            
            // Check if no more notifications
            const remainingNotifications = document.querySelectorAll('.notification-card');
            if (remainingNotifications.length === 0) {
              showEmptyState();
            }
          }
        } else {
          console.error('Failed to delete notification');
        }
      } catch (error) {
        console.error('Error deleting notification:', error);
      }
    }
    
    // Clear all notifications
    async function clearAllNotifications() {
      const token = localStorage.getItem('token');
      if (!token) return;
      
      if (!confirm('Are you sure you want to clear all notifications?')) {
        return;
      }
      
      try {
        const res = await fetch('/api/notifications/clear-all', {
          method: 'DELETE',
          headers: { Authorization: "Bearer " + token }
        });
        
        if (res.ok) {
          // Clear all notification cards
          const notificationsList = document.getElementById('notifications-list');
          notificationsList.innerHTML = '';
          showEmptyState();
        } else {
          console.error('Failed to clear all notifications');
        }
      } catch (error) {
        console.error('Error clearing notifications:', error);
      }
    }
    
    // Initialize page
    document.addEventListener('DOMContentLoaded', function() {
      if (!checkAuth()) return;
      
      // Set current date and time for 2025
      const currentDate = new Date();
      console.log('Current date and time:', currentDate.toLocaleString('en-US', {
        weekday: 'long',
        year: 'numeric',
        month: 'long',
        day: 'numeric',
        hour: '2-digit',
        minute: '2-digit',
        second: '2-digit',
        hour12: true
      }));
      
      loadNotifications();
      
      // Start real-time updates for notification times
      setInterval(updateNotificationTimes, 60000); // Update every minute
      
      // Also update when page becomes visible
      document.addEventListener('visibilitychange', function() {
        if (!document.hidden) {
          updateNotificationTimes();
        }
      });
      
      // Update current time display every second
      setInterval(() => {
        const now = new Date();
        console.log('Current time:', now.toLocaleTimeString('en-US', {
          hour: '2-digit',
          minute: '2-digit',
          second: '2-digit',
          hour12: true
        }));
      }, 1000);
    });
  </script>
</body>
</html> 