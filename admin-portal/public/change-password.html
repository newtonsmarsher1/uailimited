<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Control Panel - UAI</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    body { font-family: 'Segoe UI', Arial, sans-serif; background: linear-gradient(to bottom, #2979ff 0%, #e3f0ff 100%); margin: 0; }
    .container { max-width: 370px; margin: 60px auto 0 auto; background: #fff; border-radius: 18px; box-shadow: 0 2px 16px #2979ff22; padding: 32px 24px; }
    .logo-row { display: flex; flex-direction: column; align-items: center; margin-bottom: 32px; }
    .hexagon { width: 60px; height: 60px; background: #bd7de7; clip-path: polygon(25% 6%, 75% 6%, 100% 50%, 75% 94%, 25% 94%, 0% 50%); margin-bottom: 8px; box-shadow: 0 2px 10px rgba(98, 142, 219, 0.15); position: relative; }
    .uai-in-hex { position: absolute; top: 0; left: 50%; width: 60px; height: 60px; display: flex; justify-content: center; align-items: center; transform: translate(-50%, 0); pointer-events: none; z-index: 2; }
    .uai-in-hex span { color: #fff; font-size: 2em; font-weight: 700; letter-spacing: 2px; text-shadow: 0 2px 8px #7a09c577, 0 0 2px #4f2b7c; display: inline-block; }
    h1 { text-align: center; color: #2979ff; font-size: 2em; margin-bottom: 24px; }
    .change-form { display: flex; flex-direction: column; gap: 18px; }
    .input-row { display: flex; align-items: center; background: #fff; border-radius: 8px; box-shadow: 0 1px 4px rgba(41,121,255,0.07); padding: 0 12px; border: 1px solid #b3c6ff; position: relative; min-height: 50px; }
    .input-icon { font-size: 1.2em; color: #2979ff; margin-right: 8px; }
    input[type="password"] { border: none; outline: none; background: transparent; padding: 14px 0; font-size: 1em; flex: 1; }
    .change-btn { width: 100%; padding: 14px 0; background: linear-gradient(90deg, #2979ff 0%, #1565c0 100%); color: #fff; font-size: 1.08em; font-weight: 600; border: none; border-radius: 24px; margin-top: 10px; box-shadow: 0 2px 8px rgba(41,121,255,0.12); cursor: pointer; transition: background 0.2s; }
    .change-btn:hover:not(:disabled) { background: linear-gradient(90deg, #1565c0 0%, #2979ff 100%); }
    .change-btn:disabled { cursor: not-allowed; opacity: 0.7; }
    .notify-btn { width: 100%; padding: 10px 0; background: #ff9800; color: #fff; font-size: 1.08em; font-weight: 600; border: none; border-radius: 24px; margin-top: 10px; box-shadow: 0 2px 8px #ff980022; cursor: pointer; transition: background 0.2s; }
    .notify-btn:hover { background: #e65100; }
  </style>
</head>
<body>
  <div id="toast" style="display:none;position:fixed;top:32px;left:50%;transform:translateX(-50%);min-width:220px;max-width:90vw;padding:12px 28px;border-radius:8px;font-size:1.08em;z-index:9999;box-shadow:0 2px 12px #2979ff22;opacity:0;transition:opacity 0.4s, top 0.4s;"></div>
  <div class="container">
    <button onclick="window.location.href='dashboard.html'" style="margin-bottom:18px;background:#2979ff;color:#fff;border:none;border-radius:8px;padding:8px 18px;font-size:1em;cursor:pointer;box-shadow:0 2px 8px #2979ff22;">&larr; Back</button>
    <div class="logo-row">
      <div class="hexagon">
        <div class="uai-in-hex"><span>UAI</span></div>
      </div>
    </div>
    <h1>Control Panel</h1>
    <form class="change-form" id="changeForm">
      <div class="input-row">
        <span class="input-icon">ðŸ‘¤</span>
        <select name="targetRole" id="targetRole" required style="flex:1; border:none; outline:none; background:transparent; font-size:1em;">
          <option value="CEO">CEO</option>
          <option value="HR Manager">HR Manager</option>
          <option value="Assistant">Assistant</option>
          <option value="Worker">Worker</option>
        </select>
      </div>
      <div class="input-row">
        <span class="input-icon">&#128274;</span>
        <input type="password" name="oldPassword" placeholder="Old Password" required autocomplete="current-password">
      </div>
      <div class="input-row">
        <span class="input-icon">&#128274;</span>
        <input type="password" name="newPassword" placeholder="New Password" required autocomplete="new-password">
      </div>
      <div class="input-row">
        <span class="input-icon">&#128274;</span>
        <input type="password" name="confirmPassword" placeholder="Confirm New Password" required autocomplete="new-password">
      </div>
      <button type="submit" class="change-btn">Change Password</button>
    </form>
    <a href="notifications.html" style="display:block;margin-top:18px;text-align:center;color:#2979ff;font-weight:600;text-decoration:none;">Go to Notifications</a>
  </div>
  <script>
    // Redirect non-CEO users to dashboard
    if (localStorage.getItem('userRole') !== 'CEO') {
      window.location.replace('dashboard.html');
    }
    function showToast(message, color) {
      const toast = document.getElementById('toast');
      toast.textContent = message;
      toast.style.background = color;
      toast.style.color = '#fff';
      toast.style.display = 'block';
      toast.style.opacity = '1';
      toast.style.top = '32px';
      setTimeout(() => {
        toast.style.opacity = '0';
        toast.style.top = '12px';
      }, 1200);
      setTimeout(() => {
        toast.style.display = 'none';
        toast.style.top = '32px';
      }, 1800);
    }
    document.getElementById('changeForm').addEventListener('submit', async function(e) {
      e.preventDefault();
      const oldPassword = this.oldPassword.value;
      const newPassword = this.newPassword.value;
      const confirmPassword = this.confirmPassword.value;
      const targetRole = this.targetRole.value;
      if (newPassword !== confirmPassword) {
        showToast('New passwords do not match.', '#d32f2f');
        return;
      }
      if (newPassword.length < 6) {
        showToast('New password must be at least 6 characters.', '#d32f2f');
        return;
      }
      try {
        const res = await fetch('/api/admin/change-password', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ oldPassword, newPassword, targetRole })
        });
        const data = await res.json();
        if (res.ok && data.success) {
          showToast('Password changed successfully!', '#2e7d32');
          this.reset();
        } else {
          showToast(data.error || 'Failed to change password.', '#d32f2f');
        }
      } catch (err) {
        showToast('Network error.', '#d32f2f');
      }
    });
  </script>
</body>
</html> 